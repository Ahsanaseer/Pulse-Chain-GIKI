<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate Blood - Campus Blood Donation System</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/donate.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                    <path d="M12 2.69v18.62"/>
                    <path d="M8 8h8"/>
                </svg>
                Campus Blood Donation System
            </h1>
            <p>Donate Blood</p>
        </header>


        <div class="card" style="max-width: 700px; margin: 0 auto;">
            <div id="alertContainer"></div>

            <h2 style="text-align: center; color: var(--text-primary); margin-bottom: 30px;">Donor Information Form</h2>
            <p style="text-align: center; color: var(--text-secondary); margin-bottom: 30px;">
                Please fill in your details to register as a blood donor. Your information will help connect you with those in need.
            </p>

            <form id="donateForm">
                <div class="form-group">
                    <label for="fullName">Full Name *</label>
                    <input type="text" id="fullName" name="fullName" required>
                </div>

                <div class="form-group">
                    <label for="age">Age *</label>
                    <input type="number" id="age" name="age" min="18" max="65" required>
                </div>

                <div class="form-group">
                    <label for="gender">Gender *</label>
                    <select id="gender" name="gender" required>
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bloodGroup">Blood Group *</label>
                    <select id="bloodGroup" name="bloodGroup" required>
                        <option value="">Select Blood Group</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="contact">Contact Number *</label>
                    <input type="tel" id="contact" name="contact" required>
                </div>

                <div class="form-group">
                    <label for="availability">Donor Availability *</label>
                    <select id="availability" name="availability" required>
                        <option value="">Select Availability</option>
                        <option value="Yes">Yes, Available</option>
                        <option value="No">No, Not Available</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="medicalNote">Medical Notes (Optional)</label>
                    <textarea id="medicalNote" name="medicalNote" placeholder="Any medical conditions or notes..."></textarea>
                </div>

                <button type="submit" class="btn btn-primary btn-block">Submit Donor Information</button>
            </form>
        </div>

        <div class="back-to-dashboard-container">
            <a href="index.html" class="btn-back-to-dashboard">‚Üê Back to Dashboard</a>
        </div>
    </div>

    <script type="module">
        import { addDonor } from './js/donor.js';
        import { getCurrentUser, onAuthStateChange } from './js/login.js';

        const donateForm = document.getElementById('donateForm');
        const alertContainer = document.getElementById('alertContainer');

        // Check auth state
        onAuthStateChange((user) => {
            if (!user) {
                window.location.href = 'index.html';
            }
        });

        function showAlert(message, type = 'success') {
            alertContainer.innerHTML = `
                <div class="alert alert-${type} show">
                    ${message}
                </div>
            `;
            setTimeout(() => {
                const alert = alertContainer.querySelector('.alert');
                if (alert) {
                    alert.classList.remove('show');
                    setTimeout(() => alertContainer.innerHTML = '', 300);
                }
            }, 3000);
        }

        donateForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const user = getCurrentUser();
            const formData = {
                fullName: document.getElementById('fullName').value,
                age: parseInt(document.getElementById('age').value),
                gender: document.getElementById('gender').value,
                bloodGroup: document.getElementById('bloodGroup').value,
                contact: document.getElementById('contact').value,
                availability: document.getElementById('availability').value,
                medicalNote: document.getElementById('medicalNote').value,
                userEmail: user ? user.email : '',
                userId: user ? user.uid : ''
            };

            const result = await addDonor(formData);

            if (result.success) {
                showAlert('Donor information submitted successfully! Thank you for your contribution.', 'success');
                setTimeout(() => {
                    donateForm.reset();
                }, 2000);
            } else {
                showAlert(result.error || 'Failed to submit donor information. Please try again.', 'error');
            }
        });
    </script>
</body>
</html>

